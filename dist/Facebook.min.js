/*!
bower-facebook v0.0.0 
Convenience wrapper for the Facebook SDK
Build time: Tue May 28 2013 17:49:57 GMT+0100 (BST)
*/

(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define(["module","EventEmitter"],function(module,EventEmitter){var Facebook,permissionsMap;return Facebook=function(_super){function Facebook(permissionsMap,config){var channelUrl,defaults,key,setCookie,value,_ref,_this=this;if(this.permissionsMap=permissionsMap,this.config=config,this.fbiFrameInit=__bind(this.fbiFrameInit,this),this.fbInit=__bind(this.fbInit,this),this.fbAsyncInit=__bind(this.fbAsyncInit,this),this.onReady=__bind(this.onReady,this),this.requireUserInfo=__bind(this.requireUserInfo,this),this.getUserInfo=__bind(this.getUserInfo,this),this.getPermissions=__bind(this.getPermissions,this),this.fbApi=__bind(this.fbApi,this),this.getLoginStatus=__bind(this.getLoginStatus,this),this.login=__bind(this.login,this),this.requestPermission=__bind(this.requestPermission,this),this.hasPermissions=__bind(this.hasPermissions,this),this.logout=__bind(this.logout,this),this.ui=__bind(this.ui,this),Facebook.__super__.constructor.call(this),null==this.config.appId)return console.warn("No Facebook app ID found in requirejs module config"),!1;this.cb=function(){},console.log("Facebook init"),0===this.config.appId.trim().length&&console.warn("No Facebook app ID found in config"),defaults={status:!0,cookie:!0,xfbml:!0},_ref=this.config;for(key in _ref)value=_ref[key],defaults[key]=value;this.config=defaults,this.api=null,this.isIframe=top!==self,"undefined"!=typeof FB&&null!==FB?this.fbAsyncInit():(window.fbAsyncInit=this.fbAsyncInit,this.injectFB()),this.onReady(function(FB){return FB.Event.subscribe("edge.create",function(url){return _this.fireEvent("onLike",url)}),FB.Event.subscribe("edge.remove",function(url){return _this.fireEvent("onUnlike",url)})}),0===document.cookie.length&&(channelUrl=this.config.channelUrl,setCookie=function(){var handle,popUpLocation,popUpOptions;return popUpLocation=channelUrl,console.log(popUpLocation),popUpOptions="height=200,width=150,directories=no,location=no,menubar=no,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no",handle=window.open(popUpLocation,"_blank",popUpOptions),handle&&handle.top?(handle.document.cookie="facebookjs=1;",handle.close(),document.body.removeEvent("click:relay(*)",setCookie)):void 0},document.body.addEvent("click:relay(*)",setCookie))}return __extends(Facebook,_super),Facebook.prototype.ui=function(){var args;return args=arguments.length>=1?__slice.call(arguments,0):[],this.onReady(function(FB){return FB.ui.apply(FB,args)})},Facebook.prototype.logout=function(cb){var _this=this;return null==cb&&(cb=this.cb),this.onReady(function(FB){var _ref;return console.log(_this.loginStatus),null!=(null!=(_ref=_this.loginStatus)?_ref.status:void 0)&&"connected"===_this.loginStatus.status?FB.logout(function(response){return cb(response)}):(console.warn("User is already logged out"),cb())})},Facebook.prototype.hasPermissions=function(perms){var grantedPerms,intersection,permsArray;return 0===perms.trim().length?!0:(permsArray=perms.split(","),intersection=function(a,b){var value,_i,_len,_ref,_results;for(a.length>b.length&&(_ref=[b,a],a=_ref[0],b=_ref[1]),_results=[],_i=0,_len=a.length;_len>_i;_i++)value=a[_i],__indexOf.call(b,value)>=0&&_results.push(value);return _results},grantedPerms=intersection(permsArray,this.grantedPermissions),grantedPerms.length===permsArray.length)},Facebook.prototype.requestPermission=function(scope,cb){var _this=this;return null==cb&&(cb=this.cb),FB.ui({method:"oauth",scope:scope,display:"popup"},function(){return _this.getPermissions(),cb()})},Facebook.prototype.login=function(obj){var onCancel,onLogin,scope,_ref,_this=this;return scope=null!=obj.scope?obj.scope.trim():"",onLogin=null!=obj.onLogin?obj.onLogin:function(){},onCancel=null!=obj.onCancel?obj.onCancel:function(){},null!=(null!=(_ref=this.loginStatus)?_ref.status:void 0)&&"connected"===this.loginStatus.status?this.hasPermissions(scope)?onLogin(this.loginStatus.authResponse):(console.log("request",scope),this.requestPermission(scope,function(){return onLogin(_this.loginStatus.authResponse)})):this.onReady(function(FB){return FB.login(function(response){return response.authResponse?onLogin(response.authResponse):onCancel()},scope)})},Facebook.prototype.getLoginStatus=function(cb){var _this=this;return null==cb&&(cb=this.cb),FB.getLoginStatus(function(loginStatus){return _this.loginStatus=loginStatus,console.log("Login Status:",_this.loginStatus),cb(_this.loginStatus)})},Facebook.prototype.fbApi=function(query,cb){return null==cb&&(cb=this.cb),this.onReady(function(FB){return FB.api(query,function(response){return null!=response.error&&console.warn(response.error.message),cb(response)})})},Facebook.prototype.getPermissions=function(cb){var _this=this;return null==cb&&(cb=this.cb),this.fbApi("/me?fields=permissions",function(response){var permission;return null!=response.error?(console.warn(response.error.message),cb(!1),void 0):(_this.grantedPermissions=function(){var _results;_results=[];for(permission in response.permissions.data[0])_results.push(permission);return _results}(),cb(_this.grantedPermissions))})},Facebook.prototype.getUserInfo=function(data,cb){var fields;return null==cb&&(cb=this.cb),fields=data.join(","),this.fbApi("/me?fields="+fields,function(response){return cb(response)})},Facebook.prototype.requireUserInfo=function(data,cb){var field,getInfo,requiredPermissions,requiredScope,_this=this;return null==cb&&(cb=this.cb),requiredPermissions=function(){var _i,_len,_results;for(_results=[],_i=0,_len=data.length;_len>_i;_i++)field=data[_i],null!=this.permissionsMap[field]&&_results.push(this.permissionsMap[field]);return _results}.call(this),requiredScope=requiredPermissions.join(","),getInfo=function(){return _this.getUserInfo(data,cb)},"connected"!==this.loginStatus.status?this.login({scope:requiredScope,onLogin:function(){return _this.getPermissions(getInfo)}}):this.hasPermissions(requiredScope)?getInfo():this.requestPermission(requiredScope,getInfo)},Facebook.prototype.onReady=function(callback){return null==callback&&(callback=this.cb),"undefined"!=typeof FB&&null!==FB?callback(FB):this.once("fbInit",function(){return callback(FB)})},Facebook.prototype.fbAsyncInit=function(){return this.fbInit(),this.isIframe?this.fbiFrameInit():void 0},Facebook.prototype.fbInit=function(){var _this=this;return FB.init(this.config),0!==this.config.appId.trim().length?(this.getLoginStatus(function(loginStatus){return"connected"===loginStatus.status?_this.getPermissions(function(){return _this.fireEvent("fbInit")}):_this.fireEvent("fbInit")}),FB.Event.subscribe("auth.login",function(loginStatus){return _this.loginStatus=loginStatus,console.log("FB.Event: auth.login"),_this.fireEvent("onLogin")}),FB.Event.subscribe("auth.statusChange",function(loginStatus){return _this.loginStatus=loginStatus,console.log("FB.Event: auth.statusChange"),_this.fireEvent("onStatusChange")}),FB.Event.subscribe("auth.authResponseChange",function(loginStatus){return _this.loginStatus=loginStatus,console.log("FB.Event: auth.authResponseChange"),_this.fireEvent("onAuthChange","connected"===_this.loginStatus.status)})):void 0},Facebook.prototype.fbiFrameInit=function(){var resizeInterval,_this=this;return FB.Canvas.scrollTo(0,0),FB.Canvas.setSize({width:810,height:document.body.offsetHeight}),null!=this.config.autoResize&&this.config.autoResize?(resizeInterval=function(){return _this.setCanvasSize(810,document.body.offsetHeight)},window.setInterval(resizeInterval,500)):void 0},Facebook.prototype.injectFB=function(){var protocol,root;if(!document.getElementById("facebook-jssdk"))return document.getElementById("fb-root")||(root=document.createElement("div"),root.setAttribute("id","fb-root"),document.body.appendChild(root)),protocol="https:"===location.protocol?"https:":"http:",requirejs([protocol+"//connect.facebook.net/en_US/all.js"])},Facebook.prototype.renderPlugins=function(cb){return null==cb&&(cb=this.cb),this.onReady(function(){var cbStack,plugin,plugins,unrenderedCount,_i,_len,_results;if(null!=document.querySelectorAll){for(plugins=document.body.querySelectorAll(".fb-like:not([fb-xfbml-state=rendered])"),unrenderedCount=plugins.length,cbStack=function(){return 0===--unrenderedCount?cb():void 0},_results=[],_i=0,_len=plugins.length;_len>_i;_i++)plugin=plugins[_i],_results.push(FB.XFBML.parse(plugin.parentNode,cbStack));return _results}return FB.XFBML.parse(document.body,cb)})},Facebook.prototype.getCanvasInfo=function(cb){return null==cb&&(cb=this.cb),this.onReady(function(FB){return FB.Canvas.getPageInfo(function(info){return cb(info)})})},Facebook.prototype.setCanvasSize=function(width,height){return this.onReady(function(FB){return FB.Canvas.setSize({width:width,height:height})})},Facebook}(EventEmitter),permissionsMap={languages:["user_likes"],bio:["user_about_me"],birthday:["user_birthday"],education:["user_education_history"],email:["email"],hometown:["user_hometown"],interested_in:["user_relationship_details"],location:["user_location"],political:["user_religion_politics"],favorite_athletes:["user_likes"],favorite_teams:["user_likes"],quotes:["user_about_me"],relationship_status:["user_relationships"],religion:["user_religion_politics"],significant_other:["user_religion_politics"],website:["user_religion_politics"],work:["user_religion_politics"]},new Facebook(permissionsMap,module.config())})}).call(this);